/*
 * Analizador Léxico del Proyecto 1 
 * del Curso Organización y Compiladores 1
 * Primer Semestre 2022
 * Sección B
 * José Rafael Solis Franco
 * 201612344
**/

package org.rafaelsolis.analizadores;
import java_cup.runtime.Symbol;
import org.rafaelsolis.beans.Conjunto;
import org.rafaelsolis.beans.Expresion;
import java.util.LinkedList;

parser code
{:
    /**
     * Listas donde se almacenarán los conjuntos y expresiones que serán
     * analizados después
    */
    private LinkedList<Conjunto> listaConjuntos = new LinkedList<Conjunto>();
    private LinkedList<Expresion> listaExpresiones = new LinkedList<Expresion>();
    private String idActual;

    /**
     * Método que se llama automáticamente ante algún error sintáctico
    */
    public void syntax_error(Symbol s) {
        System.out.println("Error sintactico en la linea "+s.left
            +" Columna: "+s.right+". No se esperaba este componente: "+s.value+".");
    }

    /**
     * Método que se llama automáticamente ante algún error sintáctico
     * en el que ya no es posible la recuperación de errores
    */
    public void unrecovered_syntax_error(Symbol s) throws java.lang.Exception{
        System.out.println("Error sintactico en la linea "+(s.left)+" Columna: " +
            s.right+". Componente "+s.value+" no reconocido.");
    }

    /**
     * Métodos que se llaman para invocar las listas de conjuntos y 
     * expresiones
    */
    public LinkedList<Conjunto> getConjuntos() {
        return listaConjuntos;
    }

    public LinkedList<Expresion> getExpresiones() {
        return listaExpresiones;
    }


:}

terminal String RCONJ;
terminal String PYCOMA, DPUNTOS, LLAVEA, LLAVEC;
terminal String CONCATENACION, DISYUNCION, CKLEENE, CPOSITIVA, CANULABLE;
terminal String ID, ASIGNACION, CONJUNTO, SEPARADOR;
terminal String COMENT_MLINEA, COMENT_ULINEA, CADENA_COMILLAS;

non terminal INICIO, INSTR, COMENTS, DEF_CONJ, DEF_CONJP;
non terminal DEF_EXPR, DEF_EXPRP, PREFIJ, PREFIJP;
non terminal TERMINAL, EVALUA, EVALUAP;

start with INICIO;

INICIO::= LLAVEA INSTR LLAVEC;

INSTR::=
      COMENTS INSTR
    | COMENTS
    | DEF_CONJ
;

COMENTS::=
      COMENT_MLINEA
    | COMENT_ULINEA
;

DEF_CONJ::=
      RCONJ DPUNTOS ID:a ASIGNACION CONJUNTO:b PYCOMA DEF_CONJP {: listaConjuntos.add(new Conjunto(a, b)); :}
;

DEF_CONJP::=
      COMENTS DEF_CONJP
    | DEF_CONJ
    | DEF_EXPR
;

DEF_EXPR::=
    ID:a ASIGNACION PREFIJ:b PYCOMA DEF_EXPRP {: idActual = a; :}
;

DEF_EXPRP::=
      COMENTS DEF_EXPRP
    | DEF_EXPR
    | SEPARADOR SEPARADOR EVALUAP
;

PREFIJ::=
      PREFIJP
    | TERMINAL PREFIJ
    | TERMINAL
;

PREFIJP::=
      CONCATENACION:a PREFIJ {: listaExpresiones.add(new Expresion(idActual, a)); :}
    | DISYUNCION:a PREFIJ    {: listaExpresiones.add(new Expresion(idActual, a)); :}
    | CKLEENE:a PREFIJ       {: listaExpresiones.add(new Expresion(idActual, a)); :}
    | CPOSITIVA:a PREFIJ     {: listaExpresiones.add(new Expresion(idActual, a)); :}
    | CANULABLE:a PREFIJ     {: listaExpresiones.add(new Expresion(idActual, a)); :}
;

TERMINAL::=
      LLAVEA ID:a LLAVEC {: listaExpresiones.add(new Expresion(idActual, a)); :}
    | CADENA_COMILLAS :a {: listaExpresiones.add(new Expresion(idActual, a)); :}
;

EVALUA::= 
      ID DPUNTOS CADENA_COMILLAS PYCOMA EVALUAP
    | ID DPUNTOS CADENA_COMILLAS PYCOMA
;

EVALUAP::=
      EVALUA
    | COMENTS EVALUAP
    | COMENTS
;

